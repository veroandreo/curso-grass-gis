{
  "hash": "f8b7fd93666d5653552bc690985fe5bf",
  "result": {
    "markdown": "---\ntitle: \"Intro a OBIA\"\nauthor: Verónica Andreo\ntitle-slide-attributes: \n  data-background-color: \"#1A428A\"\nformat:\n  revealjs: \n    hash-type: number \n    slide-number: true\n    chalkboard: \n      buttons: true\n    preview-links: auto\n    logo: \"../assets/img/G-UNC-CONAE-C.png\"\n    theme: [default, gulich]\n---\n\n### Contenidos\n\n- Nociones básicas sobre OBIA\n- Flujo de trabajo en OBIA\n- Segmentación\n- Optimización de parámetros de segmentación\n- Generación de capas de información\n- Estadística de segmentos\n- Clasificación de segmentos\n- Módulos y extensiones de GRASS para OBIA \n\n---\n\n### Análisis de imágenes\n\n:::: columns\n:::{.column width=50%}\n![Datos](../assets/img/rgb_cba.png)\n:::\n\n:::{.column width=50%}\n![Información](../assets/img/obia_cba.png)\n:::\n::::\n\n---\n\n### Alta resolución vs Muy alta resolución\n\n![](../assets/img/HR_VHR.png){fig-align=\"center\" width=60%}\n<br>\n\n:::: columns\n:::{.column width=\"50%\" .tiny}\n- pixel 10 x 10 m\n- libre acceso\n- mayor res espectral\n- mayor res temporal\n- mayor extensión\n:::\n\n:::{.column width=\"50%\" .tiny}\n- pixel 0.2 x 0.2m\n- (alto) costo\n- menor res espectral\n- menor re temporal\n- menor extension\n:::\n::::\n\n---\n\n### Alta resolución vs Muy alta resolución\n\n:::: columns\n:::{.column width=\"33%\" .tiny}\n![](../assets/img/20m_pix.png)\n\n- Varios objetos geográficos en el mismo pixel\n- Respuesta espectral mixta, no hay delineación clara de los objetos\n:::\n\n:::{.column width=\"33%\" .tiny}\n![](../assets/img/5m_pix.png)\n\n- Algunos píxeles de respuesta espectral mixta y algunos puros\n- Resolución espacial ~ tamaño de algunos objetos geográficos\n:::\n\n:::{.column width=\"33%\" .tiny}\n![](../assets/img/125cm_pix.png)\n\n- La mayoría de los píxeles pertenecen a una única clase \n- Un solo objeto geográfico contiene varios píxeles\n:::\n::::\n\n::: footer\n@blaschke_object_2010\n:::\n\n---\n\n### OBIA: Object-based image analysis\n\n<br>\n\n**Idea general**: agrupar los píxeles en objetos antes de clasificarlos\n\n<br>\n\n:::: columns\n:::{.column width=50%}\n**Ventajas:**\n\n- Se consideran las características de los objetos, no los píxeles\n- Salida más suave (sin efecto \"sal y pimienta\")\n:::\n\n:::{.column width=50%}\n**Dificultades:**\n\n- Necesidad de identificar primero los \"objetos\"\n- Necesidad de definir la \"mejor\" delimitación de los objetos\n:::\n::::\n\n---\n\nEjemplo del efecto *sal y pimienta*\n\n![](../assets/img/salt_pepper.png){fig-align=\"center\"}\n\n---\n\n### Etapas en la aproximación OBIA\n\n- Pre-procesamiento\n- Segmentación\n- Obtención de estadística de los objetos\n- (Selección de *features*)\n- Clasificación\n- Post-clasificación\n\n---\n\n### Etapas en la aproximación OBIA\n\n- Pre-procesamiento\n- **Segmentación**\n- **Obtención de estadística de los objetos**\n- Selección de *features*\n- **Clasificación**\n- Post-clasificación\n\n---\n\n### Segmentación\n\n- *¿Qué es?*\n  - Agrupación de píxeles en objetos\n\n- *¿Cómo deberían ser los resultados?*\n  - La mejor aproximación/delineación posible de los objetos reales\n  - Heterogeneidad espectral dentro de los objetos (ej.: 1/2 techo en el sol, 1/2 en la sombra)\n\n---\n\n:::{.callout-important .tiny}\nEs necesaria una **buena segmentación para una buena clasificación**\n\n  - Una mala segmentación puede afectar dramáticamente los resultados de la clasificación\n  - La segmentación *óptima* no es necesariamente la misma en toda la imagen\n:::\n\n---\n\n#### Sobre-segmentación, sub-segmentación y trade-off\n\n<br>\n\n![](../assets/img/ejemplo_sub_sobre_segm.png){fig-align=\"center\"}\n\n---\n\n#### Cómo seleccionar los parámetros *óptimos*\n\n- Manualmente, **ensayo y error** para ajustar iterativamente los parámetros y \nproducir los segmentos esperados\n- Optimización **automatizada**\n  - *Supervisada*: con polígonos de referencia >> Requiere conocimiento *a priori*\n  - *No supervisada*: sólo confiando en las estadísticas de la imagen >> No requiere conocimiento *a priori*\n\n---\n\n:::{.callout-important title=\"Importante\" .tiny}\n- No hay una segmentación perfecta: **es siempre un compromiso**\n- Preferencia por objetos sobre-segmentados sobre aquellos sub-segmentados\n - Los objetos sub-segmentados contienen diferentes clases de cubierta terrestre \n >> difíciles de clasificar\n - Los objetos sobre-segmentados pueden ser fusionados durante la clasificación\n:::\n\n---\n\n### Segmentación en GRASS GIS\n\n[i.segment](https://grass.osgeo.org/grass-stable/manuals/i.segment.html)\n\n![](../assets/img/i_segment.png){width=50% fig-align=\"center\"}\n\n---\n\n#### Region growing \n\n- Dos parámetros:\n  - `threshold`: similitud espectral entre segmentos adyacentes\n  - `minsize`: tamaño mínimo (# de píxeles) del segmento en la salida final\n\n---\n\nDiagrama explicativo del algoritmo *region growing*\n\n![](../assets/img/region_growing.jpg){width=65% fig-align=\"center\"}\n\n---\n\n#### Mean shift\n\n- 3 parámetros y 2 opciones:\n  - `threshold`: similitud espectral entre segmentos adyacentes\n  - `hr`: rango, sólo las celdas dentro del rango se consideran para realizar el mean shift\n  - `radius`: radio espacial en número de celdas\n  - `-a` usar rango adaptable para mean shift\n  - `-p` usar radio progresivo para mean shift\n\n---\n\n![](../assets/img/mean_shift.gif){width=65% fig-align=\"center\"}\n\n---\n\n### Segmentación en GRASS GIS\n\n- La salida de la segmentación es en formato raster\n  - El valor de los píxeles corresponde al ID del segmento (único)\n  - Puede transformarse en vector con el módulo [r.to.vect](https://grass.osgeo.org/grass-stable/manuals/r.to.vect.html)\n\n![](../assets/img/i_segment.png){width=50% fig-align=\"center\"}\n\n---\n\n### Unsupervised Segmentation Parameter Optimization - USPO\n\n- Permite la selección automatizada del **\"mejor\"** valor para un parámetro entre una serie de valores\n- Basado en el cálculo de las estadísticas de los objetos\n  - Varianza ponderada (homogeneidad intra-segmentos)\n  - Autocorrelación espacial (heterogeneidad entre segmentos)\n\n---\n\n### USPO en GRASS GIS\n\n[i.segment.uspo](https://grass.osgeo.org/grass7/manuals/addons/i.segment.uspo.html)\n\n:::: columns\n:::{.column width=50%}\n![](../assets/img/uspo.png)\n:::\n\n:::{.column width=50%}\n- Primero identificar los valores extremos (sobre y sub-segmentación) >> rango de valores a evaluar\n- Con capacidad de hardware limitada, no probar demasiadas combinaciones y trabajar en una región limitada\n:::\n::::\n\n::: footer\n@georganos_scale_2018\n:::\n\n---\n\n### USPO en GRASS GIS\n\n- Salida de *i.segment.uspo*: la selección de los mejores valores de los parámetros que se introducirán en *i.segment*\n\n![](../assets/img/terminal_uspo.png)\n\n- Opcionalmente, los primeros X mejores resultados pueden guardarse directamente como capas raster\n\n---\n\n*i.segment.uspo* pedirá los nombres de un grupo de imágenes y regiones \ncomputacionales\n\n<br><br>\n\n:::{.callout-caution title=\"Tarea\"}\nQué módulos usábamos para esas tareas?\n:::\n\n---\n\nPara áreas extensas, *i.segment.uspo* se puede usar para segmentar \nautomáticamente tiles pequeños, cada uno con un parámetro optimizado\n\n:::: columns\n\n:::{.colum width=80% .center}\n[i.cutlines](https://grass.osgeo.org/grass-stable/manuals/addons/i.cutlines.html)\n\n![](../assets/img/cutlines.png){width=70% fig-align=\"center\"}\n:::\n::::\n\n---\n\n### Obtención de información derivada\n\n- Índices de vegetación: [i.vi](https://grass.osgeo.org/grass-stable/manuals/i.vi.html) o [r.mapcalc](https://grass.osgeo.org/grass-stable/manuals/r.mapcalc.html)\n- Índices de agua: [i.wi](https://grass.osgeo.org/grass-stable/manuals/addons/i.wi.html) o [r.mapcalc](https://grass.osgeo.org/grass-stable/manuals/r.mapcalc.html)\n- Texturas: [r.texture](https://grass.osgeo.org/grass-stable/manuals/r.texture.html) o [r.texture.tiled](https://grass.osgeo.org/grass-stable/manuals/addons/r.texture.tiled.html)\n\n![](../assets/img/ndvi_ndwi.png){width=\"50%\" fig-align=\"center\"}\n\n---\n \n#### GLCM textures\n\n- Grey-level co-occurrence matrix\n- Importante fuente de información\n- En el entorno urbano, utilizando imágenes de resolución espacial media, ayuda\na identificar las estructuras/funciones urbanas (por ejemplo, los asentamientos \ninformales)\n\n:::: columns\n:::{.column width=\"50%\"}\n![](../assets/img/vhr_pan.png) \n:::\n:::{.column width=\"50%\"}\n![](../assets/img/spot_texture.png)\n:::\n::::\n\n---\n\n### Estadística de objetos\n\n[i.segment.stats](https://grass.osgeo.org/grass-stable/manuals/addons/i.segment.stats.html)\n\nA efectos de la clasificación, necesitamos calcular las características de los \nobjetos (estadísticas)\n\n- valores raster (bandas, índices espectrales, texturas)\n- forma del objeto (área, perímetro, compact_circle, compact_square, fd)\n- objetos del vecindario (raster stats y shape stats of all neighbours)\n\n---\n\n### Clasificación supervisada\n\n- **Basada en reglas**\n  - Reglas estadísticas y valores de umbral definidos por un experto\n  - Difícil encontrar reglas que funcionen en todas partes de la imagen\n\n- **Basada en modelos** (ej. Random Forest, SVM, ANN)\n  - Clasificador entrenado usando una muestra de entrenamiento de objetos\n  - El clasificador encuentra las características con mayor poder de predicción \n  y asigna clase a todos los objetos no etiquetados\n\n---\n\n#### Clasificación basada en reglas en GRASS GIS\n\n:::: columns\n:::{.column width=50%}\n- Actualizar una columna en la tabla de atributos de una capa de vectores con [v.db.update](https://grass.osgeo.org/grass-stable/manuals/addons/v.db.update.html) o [db.execute](https://grass.osgeo.org/grass-stable/manuals/addons/db.execute.html)\n\n![](../assets/img/sql_rules.png){fig-align=\"center\"}\n:::\n\n:::{.column width=50%}\n- Reclasificar un raster resultante de la segmentación con [r.mapcalc](https://grass.osgeo.org/grass-stable/manuals/r.mapcalc.html)\n\n\n```{bash}\nr.mapcalc expression=\"\"\n```\n\n:::\n::::\n\n---\n\n#### Clasificación por machine learning en GRASS GIS\n\n[v.class.mlR](https://grass.osgeo.org/grass-stable/manuals/addons/v.class.mlR.html)\n\n- Utiliza el paquete *caret* de R\n- Varios clasificadores (Random Forest, SVM, KNN)\n- Selección de variables/features\n- Opción de combinar los resultados de distintos clasificadores a través de *majority vote*\n\n:::{.callout-note}\nPara datos raster, la extensión \n[r.learn.ml](https://grass.osgeo.org/grass-stable/manuals/addons/r.learn.ml.html) \ny [r.learn.ml2](https://grass.osgeo.org/grass-stable/manuals/addons/r.learn.ml2.html) \nnos permite usar algoritmos de aprendizaje automático para realizar \nclasificaciones supervisadas\n:::\n\n---\n\n### OBIA en GRASS GIS\n\n:::: columns\n\n:::{.column width=\"40%\"}\n![](../assets/img/obia_flow.png)\n:::\n\n:::{.column width=\"60%\" .tiny}\n- [i.segment](https://grass.osgeo.org/grass-stable/manuals/i.segment.html) para segmentación\n- [i.segment.uspo](https://grass.osgeo.org/grass-stable/manuals/addons/i.segment.uspo.html) para optimización no supervisada de los parámetros de segmentación\n- [i.segment.stats](https://grass.osgeo.org/grass-stable/manuals/addons/i.segment.stats.html) para computar estadísticas de los segmentos\n- [i.superpixels.slic](https://grass.osgeo.org/grass7/manuals/addons/i.superpixels.slic.html) para segmentación de superpixeles (SLIC y SLIC0)\n- [r.to.vect](https://grass.osgeo.org/grass-stable/manuals/r.to.vect.html) para convertir de raster a vector\n- [db.execute](https://grass.osgeo.org/grass-stable/manuals/db.execute.html) para ejecutar consultas SQL y actualizar valores en la tabla de atributos de las capas vectoriales (clasificación basada en reglas)\n- [r.mapcalc](https://grass.osgeo.org/grass-stable/manuals/r.mapcalc.html) para cálculos raster, ej. clasificación basada en reglas\n- [v.class.mlR](https://grass.osgeo.org/grass7/manuals/addons/v.class.mlR.html) para el aprendizaje automático, basado en *caret* de R\n- [i.cutlines](https://grass.osgeo.org/grass7/manuals/addons/i.cutlines.html) para la partición automatizada (tiling) de una gran escena por líneas naturales\n:::\n::::\n\n::: footer\n@grippa_open_source_2017, @georganos_scale_2018\n:::\n\n---\n\n## Referencias\n\n::: {#refs .tiny}\n:::\n\n---\n\n<br><br><br>\n\n::: {.center}\n![](../assets/img/grass_logo_alphab.png)\n:::\n\n",
    "supporting": [
      "intro_obia_files"
    ],
    "filters": [],
    "includes": {}
  }
}